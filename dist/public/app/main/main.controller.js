"use strict";angular.module("fdjApp").controller("MainCtrl",function($rootScope,$http,upThis,upVar){function initMaster(){upThis.initAnnee(function(){upThis.initMois(function(){upThis.initPrestataire1(function(){upThis.initPrestataire2(function(){upThis.initSegment(function(e){upThis.initSousSegment(e,function(){updateData()})})})})})})}function namePlanAction(){$rootScope.selection.titrePlanAction="";var e=$rootScope.selection.prestataire_value1.Prestataire_Libel.toString().replace(" ",""),o=$rootScope.selection.prestataire_value2.Prestataire_Libel.toString().replace(" ",""),t=$rootScope.selection.segment_value.Segment_Libel.toString().replace(" ",""),i=$rootScope.selection.sous_segment_value.Sous_Seg_Libel.toString().replace(" ","");"Global"!=e&&($rootScope.selection.titrePlanAction=e),"Global"!=o&&($rootScope.selection.titrePlanAction=$rootScope.selection.titrePlanAction+" | "+o),"Global"!=t&&($rootScope.selection.titrePlanAction=$rootScope.selection.titrePlanAction+" | "+t+" | "+i)}function updateData(){$rootScope.onglet=1;var onglet=$rootScope.onglet,Code_Periode=upVar.periode.mois.Code_Mois,Code_Prestataire=upVar.prestataire.res.Code_Prestataire,Code_Segment=upVar.segmentation.segment.Code_Segment,Code_SousSegment=upVar.segmentation.sous_segment.Code_Sous_Seg,tmp=parseInt(Code_Periode.toString().split("")[2]+Code_Periode.toString().split("")[3]);if(0==tmp)var Code_TypePeriode=1;else var Code_TypePeriode=2;var Global="Global",prestataire1=$rootScope.selection.prestataire_value1.Prestataire_Libel.toString().replace(" ",""),prestataire2=$rootScope.selection.prestataire_value2.Prestataire_Libel.toString().replace(" ",""),segment=$rootScope.selection.segment_value.Segment_Libel.toString().replace(" ",""),sousSegment=$rootScope.selection.sous_segment_value.Sous_Seg_Libel.toString().replace(" ",""),nomOnglet="synthesis";eval("$rootScope.selection."+nomOnglet+" = []"),eval("$rootScope.selection."+nomOnglet+".comparaison = []"),$rootScope.updateView(onglet,upVar.onglet.comparaison,upVar.onglet.evolution,upVar.onglet.view_value),$rootScope.updateCase(prestataire1,prestataire2,segment,sousSegment,Global),upThis.initEff(Code_Periode,Code_Prestataire,Code_Segment,Code_SousSegment,Code_TypePeriode),upThis.initQuestion(onglet,function(questions){$rootScope.questions=questions,$rootScope.loading=!0,upThis.initTimeLineSynthese(questions,Code_Periode,Code_Prestataire,Code_Segment,Code_SousSegment,Code_TypePeriode,function(TableauEnEvolution){eval("$rootScope.selection."+nomOnglet+".evolution6Mois = [];"),eval("$rootScope.selection."+nomOnglet+".evolution6Mois = TableauEnEvolution;"),$rootScope.loading=!1}),$rootScope.updateComparateur(onglet,Code_Periode,Code_Prestataire,Code_Segment,Code_SousSegment,Code_TypePeriode,prestataire1,prestataire2,segment,sousSegment,Global,questions,nomOnglet,0,function(tableau_Periode_Selectionne){for(var indice in tableau_Periode_Selectionne){var referencePeriodeSelectionne=tableau_Periode_Selectionne[indice].col,referencePeriodePrecedente=[],evo=$rootScope.comparaison(referencePeriodeSelectionne,referencePeriodePrecedente),nom=tableau_Periode_Selectionne[indice].nom;eval("$rootScope.selection."+nomOnglet+".comparaison[0].tab.push({nom:nom, col:referencePeriodeSelectionne, evo:evo})")}}),namePlanAction(),upThis.initActionPlan(Code_Periode,Code_Prestataire,Code_Segment,Code_SousSegment,Code_TypePeriode,function(e,o){$rootScope.selection.planAction=[];for(var t=0;t<e.length;t++)$rootScope.selection.planAction[t]={QuestionGood:e[t].libel_appli_1,resulGood:e[t].resul,QuestionBad:o[t].libel_appli_1,resulBad:o[t].resul}})})}$rootScope.getMois=function(e){upVar.periode.annee.Code_Annee=e.codePeriod,upVar.periode.mois.Code_Mois=e.codePeriod,upThis.initMois(function(){updateData()})},$rootScope.MoisVal=function(e){upVar.periode.mois.Code_Mois=e.codePeriod,updateData()},$rootScope.updatePrestataire=function(){var e=$rootScope.selection.prestataire_value1.Prestataire_Libel.replace(" ","")+"%|%"+$rootScope.selection.prestataire_value2.Prestataire_Libel.replace(" ","");upVar.prestataire.premier.Prestataire_Libel=$rootScope.selection.prestataire_value1.Prestataire_Libel.replace(" ",""),upVar.prestataire.deuxieme.Prestataire_Libel=$rootScope.selection.prestataire_value2.Prestataire_Libel.replace(" ",""),upThis.initPrestataire(e,function(e){upVar.prestataire.res.Code_Prestataire=e,updateData()})},$rootScope.getSousSegment=function(e){upVar.segmentation.segment.Code_Segment=e.Code_Segment,upVar.segmentation.segment.Segment_Libel=e.Segment_Libel,upThis.initSousSegment(e.Code_Segment,function(e){upVar.segmentation.sous_segment.Code_Sous_Seg=e,console.log(upVar.segmentation.sous_segment.Code_Sous_Seg),updateData()})},$rootScope.updateSousSegment=function(e){upVar.segmentation.sous_segment.Code_Sous_Seg=e.Code_Sous_Seg,upVar.segmentation.sous_segment.Sous_Seg_Libel=e.Sous_Seg_Libel,updateData()},initMaster()});